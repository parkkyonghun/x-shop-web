{"version":3,"sources":["../../../../src/actions/order.ts","../../../../.next-internal/server/app/checkout/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\n\nimport db from \"@/lib/db\";\nimport { getSession } from \"@/lib/session\";\nimport { CartItem } from \"@/types\";\nimport crypto from \"crypto\";\nimport { redirect } from \"next/navigation\";\n\nexport async function createOrder(cartItems: CartItem[], total: number) {\n    const session = await getSession();\n    const user = session?.user;\n\n    if (!user) {\n        return { error: \"You must be logged in to place an order\" };\n    }\n\n    const orderId = crypto.randomUUID();\n\n    try {\n        const insertOrder = db.prepare(\n            \"INSERT INTO orders (id, user_id, total, status) VALUES (?, ?, ?, ?)\"\n        );\n        insertOrder.run(orderId, user.id, total, \"Pending\");\n\n        const insertOrderItem = db.prepare(\n            \"INSERT INTO order_items (id, order_id, product_id, quantity, price) VALUES (?, ?, ?, ?, ?)\"\n        );\n\n        const insertManyItems = db.transaction((items: CartItem[]) => {\n            for (const item of items) {\n                insertOrderItem.run(crypto.randomUUID(), orderId, item.id, item.quantity, item.price);\n            }\n        });\n\n        insertManyItems(cartItems);\n    } catch (err) {\n        console.error(\"Failed to create order:\", err);\n        return { error: \"Failed to create order\" };\n    }\n\n    return { success: true, orderId };\n}\n\nexport async function getOrders() {\n    const session = await getSession();\n    const user = session?.user;\n\n    if (!user) return [];\n\n    const orders = db.prepare(\"SELECT * FROM orders WHERE user_id = ? ORDER BY created_at DESC\").all(user.id);\n    return orders;\n}\n\nexport async function getOrderDetails(orderId: string) {\n    const session = await getSession();\n    const user = session?.user;\n\n    if (!user) return null;\n\n    const order = db.prepare(\"SELECT * FROM orders WHERE id = ? AND user_id = ?\").get(orderId, user.id);\n\n    if (!order) return null;\n\n    const items = db.prepare(`\n        SELECT oi.*, p.name, p.image \n        FROM order_items oi \n        JOIN products p ON oi.product_id = p.id \n        WHERE oi.order_id = ?\n    `).all(orderId);\n\n    return { ...order, items };\n}\n","export {logoutAction as '002e10a5ce62c25926c80418bbc53ea91a20393242'} from 'ACTIONS_MODULE0'\nexport {createOrder as '6024d3f96e3f9c181c5f57eaa8049fc4190206b9b4'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,EAAY,CAAqB,CAAE,CAAa,EAClE,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,IAC1B,EAAO,GAAS,KAEtB,GAAI,CAAC,EACD,IADO,EACA,CAAE,MAAO,yCAA0C,EAG9D,IAAM,EAAU,EAAA,OAAM,CAAC,UAAU,GAEjC,GAAI,CACoB,AAGpB,EAHoB,OAAE,CAAC,OAAO,CAC1B,uEAEQ,GAAG,CAAC,EAAS,EAAK,EAAE,CAAE,EAAO,WAEzC,IAAM,EAAkB,EAAA,OAAE,CAAC,OAAO,CAC9B,8FAGoB,AAMxB,EANwB,OAAE,CAAC,WAAW,CAAE,AAAD,IACnC,IAAK,IAAM,KAAQ,EACf,EAAgB,EADM,CACH,CAAC,EAAA,OAAM,CAAC,UAAU,GAAI,EAAS,EAAK,EAAE,CAAE,EAAK,QAAQ,CAAE,EAAK,KAAK,CAE5F,GAEgB,EACpB,CAAE,MAAO,EAAK,CAEV,OADA,QAAQ,KAAK,CAAC,0BAA2B,GAClC,CAAE,MAAO,wBAAyB,CAC7C,CAEA,MAAO,CAAE,QAAS,WAAM,CAAQ,CACpC,CAEO,eAAe,IAClB,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,IAC1B,EAAO,GAAS,YAEtB,AAAK,EAEU,EAFX,AAEW,EAFJ,KAEM,CAAC,OAAO,CAAC,mEAAmE,GAAG,CAAC,EAAK,EAAE,EAFtF,EAItB,AAJwB,CAMjB,eAAe,EAAgB,CAAe,EACjD,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,IAC1B,EAAO,GAAS,KAEtB,GAAI,CAAC,EAAM,OAAO,KAElB,IAAM,EAAQ,EAAA,OAAE,CAAC,OAAO,CAAC,qDAAqD,GAAG,CAAC,EAAS,EAAK,EAAE,EAElG,GAAI,CAAC,EAAO,OAAO,KAEnB,IAAM,EAAQ,EAAA,OAAE,CAAC,OAAO,CAAC,CAAC;;;;;IAK1B,CAAC,EAAE,GAAG,CAAC,GAEP,MAAO,CAAE,GAAG,CAAK,OAAE,CAAM,CAC7B,0CA/DsB,EAmCA,EAUA,IA7CA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAmCA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAUA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,mGCrDtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA"}